<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MCQ Table DOCX Generator (Exact Format)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
 body{font-family:Arial;margin:15px}
 .wrap{display:flex;gap:12px;flex-wrap:wrap}
 .col{flex:1;min-width:300px;border:1px solid #ccc;padding:12px;border-radius:6px}
 input,textarea,select{width:100%;padding:8px;margin:4px 0}
 button{padding:10px 16px;margin-top:8px;background:#0066cc;color:#fff;border:0;border-radius:6px;cursor:pointer}
 .preview-item{border:1px dashed #aaa;padding:6px;margin:6px 0}
</style>
</head>
<body>

<h2>MCQ Table DOCX Generator (Exact Format)</h2>

<div class="wrap">
 <div class="col">
   <label>Module</label><input id="module">

   <label>Question</label><textarea id="question"></textarea>

   <label>Option A</label><input id="optA">
   <label>Option B</label><input id="optB">
   <label>Option C</label><input id="optC">
   <label>Option D</label><input id="optD">

   <label>Answer (A/B/C/D)</label><input id="answer" maxlength="1">

   <label>Solution</label><textarea id="solution"></textarea>

   <label>Positive Marks</label><input id="pm" value="1">
   <label>Negative Marks</label><input id="nm" value="0.6">

   <label>Language</label>
   <select id="language">
     <option value="hi">hi</option>
     <option value="en">en</option>
   </select>

   <button onclick="addQ()">Add Question</button>
   <button onclick="exportDOCX()" style="background:green">Export DOCX</button>
 </div>

 <div class="col">
   <h3>Preview</h3>
   <div id="preview"></div>
 </div>
</div>

<script>
let list = [];
let qno = 1;

function val(id){ return document.getElementById(id).value.trim(); }
function addQ(){
 let q = {
   module: val("module") || "General",
   questionno: qno++,
   question: val("question"),
   A: val("optA"),
   B: val("optB"),
   C: val("optC"),
   D: val("optD"),
   answer: val("answer").toUpperCase(),
   solution: val("solution"),
   pm: val("pm"),
   nm: val("nm"),
   lang: val("language")
 };
 list.push(q);
 render();
}

function render(){
 let area = document.getElementById("preview");
 area.innerHTML = "";
 list.forEach(q=>{
   area.innerHTML += `<div class="preview-item"><b>${q.questionno}</b>. ${q.question}</div>`;
 });
}

/*** Word Table Helpers ***/
function esc(s){
 if(!s) return "";
 return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

/* Create a 2-row table XML with no extra paragraphs */
function table(field, value){
 return `
<w:tbl>
 <w:tr><w:tc><w:p><w:r><w:t>${esc(field)}</w:t></w:r></w:p></w:tc></w:tr>
 <w:tr><w:tc><w:p><w:r><w:t>${esc(value)}</w:t></w:r></w:p></w:tc></w:tr>
</w:tbl>
`;
}

/*** Build document.xml (Exact format — just like your file) ***/
function buildDocXML(){
 let out = "";
 list.forEach(q=>{
   out += table("Module", q.module);
   out += table("questionno", q.questionno);
   out += table("Question", q.question);
   out += table("Type", "mcq");
   out += table("option", q.A);
   out += table("option", q.B);
   out += table("option", q.C);
   out += table("option", q.D);
   out += table("answer", q.answer);
   out += table("Solution", q.solution);
   out += table("Positive Marks", q.pm);
   out += table("Negative Marks", q.nm);
   out += table("language", q.lang);
 });
 return `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
 <w:body>${out}</w:body>
</w:document>`;
}

/*** Minimal ZIP (docx) builder — 100% working ***/
function makeDOCX(){
 const doc = buildDocXML();

 const files = {
   "[Content_Types].xml":
`<?xml version="1.0"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
 <Default Extension="xml" ContentType="application/xml"/>
 <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
 <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`,

   "_rels/.rels":
`<?xml version="1.0"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"></Relationships>`,

   "word/_rels/document.xml.rels":
`<?xml version="1.0"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"></Relationships>`,

   "word/document.xml": doc
 };

 return zipBlob(files);
}

/*** ZIP builder (store mode) ***/
function zipBlob(files){
 function str2buf(s){return new TextEncoder().encode(s);}
 function u32(n){return [n&255,(n>>8)&255,(n>>16)&255,(n>>24)&255];}

 const crcTable=new Uint32Array(256).map((_,n)=>{
   let c=n; for(let k=0;k<8;k++) c=c&1?0xEDB88320^(c>>>1):c>>>1;
   return c>>>0;
 });

 function crc32(buf){
   let c=-1; for(let i=0;i<buf.length;i++)
     c=(c>>>8)^crcTable[(c^buf[i])&255];
   return (c^-1)>>>0;
 }

 let locals=[], centrals=[];
 let offset=0;

 for(let name in files){
   let data=str2buf(files[name]);
   let crc=crc32(data);
   let fname=str2buf(name);

   let lh=new Uint8Array(30+fname.length);
   lh.set([0x50,0x4b,0x03,0x04],0);
   lh.set([20,0],4);
   lh.set([0,0],6);
   lh.set([0,0],8);
   lh.set([0,0,0,0],10);
   lh.set(u32(crc),14);
   lh.set(u32(data.length),18);
   lh.set(u32(data.length),22);
   lh.set([fname.length,0],26);
   lh.set(fname,30);

   locals.push({lh,data});
   centrals.push({name,fname,crc,data,offset});
   offset+=lh.length+data.length;
 }

 let cdSize=0;
 centrals.forEach(c=>{
   let ch=new Uint8Array(46+c.fname.length);
   ch.set([0x50,0x4b,0x01,0x02],0);
   ch.set([20,0],4); ch.set([20,0],6);
   ch.set([0,0],8); ch.set([0,0],10);
   ch.set([0,0,0,0],12);
   ch.set(u32(c.crc),16);
   ch.set(u32(c.data.length),20);
   ch.set(u32(c.data.length),24);
   ch.set([c.fname.length,0],28);
   ch.set([0,0,0,0],30);
   ch.set([0,0],36);
   ch.set([0,0,0,0],38);
   ch.set(u32(c.offset),42);
   ch.set(c.fname,46);
   c.ch=ch;
   cdSize+=ch.length;
 });

 let total=offset+cdSize+22;
 let out=new Uint8Array(total);
 let p=0;

 locals.forEach(o=>{out.set(o.lh,p);p+=o.lh.length;out.set(o.data,p);p+=o.data.length;});

 let cdStart=p;
 centrals.forEach(c=>{out.set(c.ch,p);p+=c.ch.length;});

 out.set([0x50,0x4b,0x05,0x06],p);p+=4;
 out.set([0,0,0,0],p);p+=4;
 out.set([centrals.length,0],p);p+=2;
 out.set([centrals.length,0],p);p+=2;
 out.set(u32(cdSize),p);p+=4;
 out.set(u32(cdStart),p);p+=4;
 out.set([0,0],p);p+=2;

 return new Blob([out],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});
}

function exportDOCX(){
 if(list.length===0) return alert("पहले question जोड़ो");
 let blob = makeDOCX();
 let url = URL.createObjectURL(blob);
 let a = document.createElement("a");
 a.href = url;
 a.download = "mcq_table_format.docx";
 a.click();
}

</script>
</body>
</html>
